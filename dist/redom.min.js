!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).redom={})}(this,(function(e){"use strict";function t(e,t){const{tag:n,id:i,className:o}=function(e){const t=e.split(/([.#])/);let n="",i="";for(let e=1;e<t.length;e+=2)switch(t[e]){case".":n+=` ${t[e+1]}`;break;case"#":i=t[e+1]}return{className:n.trim(),tag:t[0]||"div",id:i}}(e),s=t?document.createElementNS(t,n):document.createElement(n);return i&&(s.id=i),o&&(t?s.setAttribute("class",o):s.className=o),s}function n(e,...n){let i;const o=typeof e;if("string"===o)i=t(e);else{if("function"!==o)throw new Error("At least one argument required");i=new e(...n)}return y(g(i),n,!0),i}const i=n,o=n;function s(e,t){let n=t;const i=g(e),o=g(n);return n===o&&o.__redom_view&&(n=o.__redom_view),o.parentNode&&(l(n,o,i),i.removeChild(o)),n}function l(e,t,n){const i=t.__redom_lifecycle;if(r(i))return void(t.__redom_lifecycle={});let o=n;for(t.__redom_mounted&&d(t,"onunmount");o;){const e=o.__redom_lifecycle||{};for(const t in i)e[t]&&(e[t]-=i[t]);r(e)&&(o.__redom_lifecycle=null),o=o.parentNode}}function r(e){if(null==e)return!0;for(const t in e)if(e[t])return!1;return!0}n.extend=function(...e){return n.bind(this,...e)};const c=["onmount","onremount","onunmount"],u="undefined"!=typeof window&&"ShadowRoot"in window;function f(e,t,n,i){let o=t;const s=g(e),r=g(o);o===r&&r.__redom_view&&(o=r.__redom_view),o!==r&&(r.__redom_view=o);const f=r.__redom_mounted,a=r.parentNode;if(f&&a!==s&&l(0,r,a),null!=n)if(i){const e=g(n);e.__redom_mounted&&d(e,"onunmount"),s.replaceChild(r,e)}else s.insertBefore(r,g(n));else s.appendChild(r);return function(e,t,n,i){t.__redom_lifecycle||(t.__redom_lifecycle={});const o=t.__redom_lifecycle,s=n===i;let l=!1;for(const n of c)s||e!==t&&n in e&&(o[n]=(o[n]||0)+1),o[n]&&(l=!0);if(!l)return void(t.__redom_lifecycle={});let r=n,f=!1;(s||(null==r?void 0:r.__redom_mounted))&&(d(t,s?"onremount":"onmount"),f=!0);for(;r;){const e=r.parentNode;r.__redom_lifecycle||(r.__redom_lifecycle={});const t=r.__redom_lifecycle;for(const e in o)t[e]=(t[e]||0)+o[e];if(f)break;(r.nodeType===Node.DOCUMENT_NODE||u&&r instanceof ShadowRoot||(null==e?void 0:e.__redom_mounted))&&(d(r,s?"onremount":"onmount"),f=!0),r=e}}(o,r,s,a),o}function d(e,t){var n;"onmount"===t||"onremount"===t?e.__redom_mounted=!0:"onunmount"===t&&(e.__redom_mounted=!1);const i=e.__redom_lifecycle;if(!i)return;const o=e.__redom_view;let s=0;null==(n=null==o?void 0:o[t])||n.call(o);for(const e in i)e&&s++;if(s){let n=e.firstChild;for(;n;){const e=n.nextSibling;d(n,t),n=e}}}function a(e,t,n){const i=g(e);if("object"==typeof t)for(const e in t)h(i,e,t[e]);else h(i,t,n)}function h(e,t,n){e.style[t]=null==n?"":n}const _="http://www.w3.org/1999/xlink";function m(e,t,n,i){const o=g(e);if("object"==typeof t)for(const e in t)m(o,e,t[e],i);else{const e=o instanceof SVGElement,s="function"==typeof n;if("style"===t&&"object"==typeof n)a(o,n);else if(e&&s)o[t]=n;else if("dataset"===t)p(o,n);else if(e||!(t in o)&&!s||"list"===t){if(e&&"xlink"===t)return void w(o,n);if(i&&"class"===t)return void function(e,t){null==t?e.removeAttribute("class"):e.classList?e.classList.add(t):"object"==typeof e.className&&e.className&&e.className.baseVal?e.className.baseVal=`${e.className.baseVal} ${t}`.trim():e.className=`${e.className} ${t}`.trim()}(o,n);null==n?o.removeAttribute(t):o.setAttribute(t,n)}else o[t]=n}}function w(e,t,n){if("object"==typeof t)for(const n in t)w(e,n,t[n]);else null!=n?e.setAttributeNS(_,t,n):e.removeAttributeNS(_,t,n)}function p(e,t,n){if("object"==typeof t)for(const n in t)p(e,n,t[n]);else null!=n?e.dataset[t]=n:delete e.dataset[t]}function v(e){return document.createTextNode(null!=e?e:"")}function y(e,t,n){for(const i of t){if(0!==i&&!i)continue;const t=typeof i;"function"===t?i(e):"string"===t||"number"===t?e.appendChild(v(i)):N(g(i))?f(e,i):i.length?y(e,i,n):"object"===t&&m(e,i,null,n)}}function b(e){return"string"==typeof e?n(e):g(e)}function g(e){return e.nodeType&&e||!e.el&&e||g(e.el)}function N(e){return null==e?void 0:e.nodeType}function x(e,...t){let n=k(e,t,g(e).firstChild);for(;n;){const t=n.nextSibling;s(e,n),n=t}}function k(e,t,n){let i=n;const o=Array(t.length);for(let e=0;e<t.length;e++)o[e]=t[e]&&g(t[e]);for(let n=0;n<t.length;n++){const s=t[n];if(!s)continue;const l=o[n];if(l!==i)if(N(l)){const t=null==i?void 0:i.nextSibling,l=null!=s.__redom_index&&t===o[n+1];f(e,s,i,l),l&&(i=t)}else null!=s.length&&(i=k(e,s,i));else i=i.nextSibling}return i}class S{update(e,t){var n;const{View:i,key:o,initData:s}=this,l=null!=o,r=this.lookup,c={},u=Array(e.length),f=this.views;for(let d=0;d<e.length;d++){const a=e[d];let h;if(l){const t=o(a);h=r[t]||new i(s,a,d,e),c[t]=h,h.__redom_id=t}else h=f[d]||new i(s,a,d,e);null==(n=h.update)||n.call(h,a,d,e,t);g(h.el).__redom_view=h,u[d]=h}this.oldViews=f,this.views=u,this.oldLookup=r,this.lookup=c}constructor(e,t,n){this.View=e,this.initData=n,this.oldLookup={},this.lookup={},this.oldViews=[],this.views=[],null!=t&&(this.key="function"==typeof t?t:function(e){return function(t){return t[e]}}(t))}}function E(e,t,n,i){return new V(e,t,n,i)}class V{update(e,t){const{keySet:n}=this,i=this.views;this.pool.update(e||[],t);const{views:o,lookup:l}=this.pool;if(n)for(let e=0;e<i.length;e++){const t=i[e];null==l[t.__redom_id]&&(t.__redom_index=null,s(this,t))}for(let e=0;e<o.length;e++){o[e].__redom_index=e}x(this,o),n&&(this.lookup=l),this.views=o}constructor(e,t,n,i){this.View=t,this.initData=i,this.views=[],this.pool=new S(t,n,i),this.el=b(e),this.keySet=null!=n}}V.extend=function(e,t,n,i){return V.bind(V,e,t,n,i)},E.extend=V.extend;class j{update(e,t){var n,i;const o=this._placeholder,l=this.el.parentNode;if(e){if(!this.visible)if(this._el)f(l,this._el,o),s(l,o),this.el=g(this._el),this.visible=e;else{const e=new(0,this._View)(this._initData);this.el=g(e),this.view=e,f(l,e,o),s(l,o)}null==(i=null==(n=this.view)?void 0:n.update)||i.call(n,t)}else if(this.visible){if(this._el)return f(l,o,this._el),s(l,this._el),this.el=o,void(this.visible=e);f(l,o,this.view),s(l,this.view),this.el=o,this.view=null}this.visible=e}constructor(e,t){this.el=v(""),this.visible=!1,this.view=null,this._placeholder=this.el,e instanceof Node?this._el=e:e.el instanceof Node?(this._el=e,this.view=e):this._View=e,this._initData=t}}class A{update(e,t){var n,i;if(e!==this.route){const n=this.views[e];this.route=e,n&&(n instanceof Node||n.el instanceof Node)?this.view=n:this.view=n&&new n(this.initData,t),x(this.el,[this.view])}null==(i=null==(n=this.view)?void 0:n.update)||i.call(n,t,e)}constructor(e,t,n){this.el=b(e),this.views=t,this.Views=t,this.initData=n}}const D="http://www.w3.org/2000/svg";function C(e,...n){let i;const o=typeof e;if("string"===o)i=t(e,D);else{if("function"!==o)throw new Error("At least one argument required");i=new e(...n)}return y(g(i),n,!0),i}const T=C;C.extend=function(...e){return C.bind(this,...e)},C.ns=D,e.List=V,e.ListPool=S,e.Place=j,e.Router=A,e.dispatch=function(e,t,n="redom"){const i=g(e),o=new CustomEvent(n,{bubbles:!0,detail:t});i.dispatchEvent(o)},e.el=i,e.h=o,e.html=n,e.list=E,e.listPool=function(e,t,n){return new S(e,t,n)},e.mount=f,e.place=function(e,t){return new j(e,t)},e.ref=function(e,t,n){return e[t]=n,n},e.router=function(e,t,n){return new A(e,t,n)},e.s=T,e.setAttr=function(e,t,n){m(e,t,n)},e.setChildren=x,e.setData=p,e.setStyle=a,e.setXlink=w,e.svg=C,e.text=v,e.unmount=s,e.viewFactory=function(e,t){if(!e||"object"!=typeof e)throw new Error("views must be an object");if(!t||"string"!=typeof t)throw new Error("key must be a string");return function(n,i,o,s){const l=i[t],r=e[l];if(r)return new r(n,i,o,s);throw new Error(`view ${l} not found`)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));