<!DOCTYPE html>
<html>
  <body>
    <script>
    css({
    	body: {
      	color: 'red',
        p: {
          fontFamily: 'sans-serif'
        }
      },
      '@media (max-width: 640px)': {
      	body: {
        	color: 'green',
          '&:hover,&:focus': {
            color: 'magenta'
          }
        }
      },
      '@keyframes': {
      	0: {
        	body: {
          	color: 'yellow'
          }
        },
        '100%': {
        	body: {
          	color: 'blue'
          }
        }
      }
    });

    function css (obj) {
      const css = [];
      walkCSS(obj, (str) => {
        css.push(str);
    	});
      console.log(css.join('\n'));
    }

    function walkCSS (obj, iterator, path = '', previousKey = '') {
      const values = [];
      const inner = [];
      const pushInner = (str) => inner.push(str);

    	for (let key in obj) {
    		const value = obj[key];

        if (typeof value === 'object') {
          if (key[0] === '@') {
            pushInner(key + '{');
    			  walkCSS(value, pushInner, '', key);
            pushInner('}');
          } else if (previousKey.slice(0, 10) === '@keyframes') {
            pushInner(key + '{');
    			  walkCSS(value, pushInner, '', key);
            pushInner('}');
          } else {
            const split = key.split(',');
            const cssKey = split.map(key => {
              if (key[0] === '&') {
                return path + key.slice(1);
              } else {
                return (path + ' ' + key).trim();
              }
            }).join(',');
            walkCSS(value, pushInner, cssKey, key);
          }
        } else {
          values.push(key + ':' + value + ';');
     		}
    	}
      if (values.length) {
        iterator(path + '{');
        iterator(values.join(''));
        iterator('}');
      }
      if (inner.length) {
        for (let i = 0; i < inner.length; i++) {
          iterator(inner[i]);
        }
      }
    }
    </script>
  </body>
</html>
